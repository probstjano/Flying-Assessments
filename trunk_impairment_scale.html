<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trunk Impairment Scale</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; max-width: 900px; font-size: 16px; }
    .question-block { margin-bottom: 1.5rem; }
    .question { font-weight: bold; margin-bottom: 0.5rem; }
    select { width: 100%; padding: 8px; font-size: 16px; }
    button { margin-top: 20px; padding: 10px 15px; font-size: 16px; }
    #result { margin-top: 2rem; font-weight: bold; white-space: pre-line; }
    .nav-buttons { margin-top: 2rem; }
    .nav-buttons a {
      display: inline-block; margin-right: 10px; padding: 10px 15px;
      background: #eee; border-radius: 8px; text-decoration: none; color: #000;
    }
    .nav-buttons a:hover { background: #ddd; }
  </style>
</head>
<body>
  <h1>Trunk Impairment Scale (TIS)</h1>
  <p>Assessment zur Erfassung der Rumpfkontrolle, insbesondere nach Schlaganfall. Die Teststruktur ist dynamisch: bestimmte Items werden nur angezeigt, wenn vorherige bestanden wurden.</p>

  <div id="form"></div>
  <button onclick="exportPDF()">üìÑ Als PDF speichern</button>

  <div id="result"></div>

  <div class="nav-buttons">
    <a href="standard.html">‚¨ÖÔ∏è Zur√ºck zu Standard-Assessments</a>
    <a href="index.html">üè† Zur Startseite</a>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const { jsPDF } = window.jspdf;

    const state = {
      values: {},
      score: { static: 0, dynamic: 0, coordination: 0 }
    };

    const items = [
      { id: "s1", section: "static", text: "1. Patient h√§lt Startposition 10 Sekunden ohne Unterst√ºtzung", options: [{text: "Nein", value: 0}, {text: "Ja", value: 2}], nextIf: 2 },
      { id: "s2", section: "static", text: "2. Therapeut kreuzt nicht-betroffenes Bein √ºber hemiplegisches", options: [{text: "F√§llt oder braucht Unterst√ºtzung", value: 0}, {text: "H√§lt Position 10 Sekunden", value: 2}] },
      { id: "s3", section: "static", text: "3. Patient kreuzt selbst nicht-betroffenes Bein √ºber hemiplegisches", options: [
        {text: "F√§llt", value: 0},
        {text: "Kann nicht ohne Armhilfe kreuzen", value: 1},
        {text: "Kreuzt mit >10 cm R√ºcklage oder Hilfe", value: 2},
        {text: "Kreuzt ohne Hilfe oder R√ºcklage", value: 3}
      ]},

      { id: "d1", section: "dynamic", text: "4. Patient ber√ºhrt Bett/Tisch mit hemiplegischem Ellbogen", options: [
        {text: "F√§llt oder ber√ºhrt nicht", value: 0},
        {text: "Bewegt aktiv ohne Hilfe, Ellbogen ber√ºhrt", value: 1}
      ], nextIf: 1 },
      { id: "d2", section: "dynamic", text: "5. Wiederholung von Item 4 (Bewegungsmuster)", options: [
        {text: "Keine oder falsche Verk√ºrzung/Verl√§ngerung", value: 0},
        {text: "Richtige Verk√ºrzung/Verl√§ngerung", value: 1}
      ], parent: "d1", nextIf: 1 },
      { id: "d3", section: "dynamic", text: "6. Wiederholung von Item 4 (Kompensation)", options: [
        {text: "Mit Kompensation", value: 0},
        {text: "Ohne Kompensation", value: 1}
      ], parent: "d2", nextIf: 1 },

      { id: "d4", section: "dynamic", text: "7. Patient ber√ºhrt Bett/Tisch mit nicht-betroffenem Ellbogen", options: [
        {text: "F√§llt oder ber√ºhrt nicht", value: 0},
        {text: "Bewegt aktiv ohne Hilfe, Ellbogen ber√ºhrt", value: 1}
      ], nextIf: 1 },
      { id: "d5", section: "dynamic", text: "8. Wiederholung von Item 7 (Bewegungsmuster)", options: [
        {text: "Keine oder falsche Verk√ºrzung/Verl√§ngerung", value: 0},
        {text: "Richtige Verk√ºrzung/Verl√§ngerung", value: 1}
      ], parent: "d4", nextIf: 1 },
      { id: "d6", section: "dynamic", text: "9. Wiederholung von Item 7 (Kompensation)", options: [
        {text: "Mit Kompensation", value: 0},
        {text: "Ohne Kompensation", value: 1}
      ], parent: "d5", nextIf: 1 },

      { id: "d7", section: "dynamic", text: "10. Hebt Becken auf hemiplegischer Seite", options: [
        {text: "Keine oder falsche Bewegung", value: 0},
        {text: "Richtige Bewegung", value: 1}
      ], nextIf: 1 },
      { id: "d8", section: "dynamic", text: "11. Wiederholung von Item 10 (Kompensation)", options: [
        {text: "Mit Kompensation", value: 0},
        {text: "Ohne Kompensation", value: 1}
      ], parent: "d7", nextIf: 1 },

      { id: "d9", section: "dynamic", text: "12. Hebt Becken auf nicht-betroffener Seite", options: [
        {text: "Keine oder falsche Bewegung", value: 0},
        {text: "Richtige Bewegung", value: 1}
      ], nextIf: 1 },
      { id: "d10", section: "dynamic", text: "13. Wiederholung von Item 12 (Kompensation)", options: [
        {text: "Mit Kompensation", value: 0},
        {text: "Ohne Kompensation", value: 1}
      ], parent: "d9", nextIf: 1 },

      { id: "c1", section: "coordination", text: "14. Rotiert oberen Rumpf 6x (hemiplegische Seite zuerst)", options: [
        {text: "Hemiplegische Seite nicht 3x bewegt", value: 0},
        {text: "Asymmetrische Rotation", value: 1},
        {text: "Symmetrische Rotation", value: 2}
      ]},
      { id: "c2", section: "coordination", text: "15. Wiederholung von Item 14 in 6 Sekunden", options: [
        {text: "Asymmetrisch", value: 0},
        {text: "Symmetrisch", value: 1}
      ]},
      { id: "c3", section: "coordination", text: "16. Rotiert unteren Rumpf 6x (hemiplegische Seite zuerst)", options: [
        {text: "Hemiplegische Seite nicht 3x bewegt", value: 0},
        {text: "Asymmetrisch", value: 1},
        {text: "Symmetrisch", value: 2}
      ]},
      { id: "c4", section: "coordination", text: "17. Wiederholung von Item 16 in 6 Sekunden", options: [
        {text: "Asymmetrisch", value: 0},
        {text: "Symmetrisch", value: 1}
      ]}
    ];

    function renderForm() {
      const container = document.getElementById("form");
      container.innerHTML = "";
      for (let i = 0; i < items.length; i++) {
        const item = items[i];
        if (item.parent && state.values[item.parent] != item.nextIf) continue;
        if (item.nextIf !== undefined && state.values[item.id] !== undefined && state.values[item.id] != item.nextIf) continue;

        if (item.id === "s1" && state.values["s1"] === 0) break;

        if (state.values[item.id] !== undefined) continue;

        const block = document.createElement("div");
        block.className = "question-block";
        block.innerHTML = `<div class="question">${item.text}</div>
          <select onchange="handleChange('${item.id}', this.value)">
            <option value="" disabled selected>Antwort ausw√§hlen</option>
            ${item.options.map(opt => `<option value="${opt.value}">${opt.text}</option>`).join("")}
          </select>`;
        container.appendChild(block);
        break;
      }

      if (Object.keys(state.values).length === items.length || state.values["s1"] === 0) {
        showResults();
      }
    }

    function handleChange(id, value) {
      const item = items.find(i => i.id === id);
      value = parseInt(value);
      state.values[id] = value;
      state.score[item.section] += value;
      renderForm();
    }

    function showResults() {
      const total = state.score.static + state.score.dynamic + state.score.coordination;
      document.getElementById("result").innerText =
        `Gesamtscore: ${total} / 21\n` +
        `Statische Balance: ${state.score.static} / 5\n` +
        `Dynamische Balance: ${state.score.dynamic} / 10\n` +
        `Koordination: ${state.score.coordination} / 6`;
    }

    function exportPDF() {
      const doc = new jsPDF();
      let y = 10;
      doc.setFontSize(16);
      doc.text("Trunk Impairment Scale ‚Äì Auswertung", 10, y);
      y += 10;
      items.forEach(item => {
        if (state.values[item.id] !== undefined) {
          const label = item.text.split(":")[1] || item.text;
          const value = item.options.find(o => o.value === state.values[item.id])?.text || "";
          doc.setFontSize(12);
          doc.text(`${label.trim()}: ${value}`, 10, y);
          y += 7;
        }
      });
      y += 10;
      doc.setFontSize(14);
      doc.text(`Gesamtscore: ${state.score.static + state.score.dynamic + state.score.coordination} / 21`, 10, y);
      y += 7;
      doc.text(`Statische Balance: ${state.score.static} / 5`, 10, y += 7);
      doc.text(`Dynamische Balance: ${state.score.dynamic} / 10`, 10, y += 7);
      doc.text(`Koordination: ${state.score.coordination} / 6`, 10, y += 7);
      window.open(doc.output("bloburl"), "_blank");
    }

    renderForm();
  </script>
</body>
</html>
