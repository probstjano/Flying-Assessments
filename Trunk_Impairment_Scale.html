<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trunk Impairment Scale (TIS)</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; font-size: 16px; max-width: 800px; }
    .question-block { margin-bottom: 1rem; }
    .question { font-weight: bold; margin-bottom: 0.5rem; }
    select { width: 100%; padding: 6px; font-size: 16px; margin-bottom: 10px; }
    button { margin-top: 20px; padding: 10px 15px; font-size: 16px; }
    #result { margin-top: 2rem; font-weight: bold; white-space: pre-line; }
    .hidden { display: none; }
    .nav-buttons { margin-top: 2rem; }
    .nav-buttons a {
      display: inline-block; margin-right: 10px; padding: 10px 15px;
      background: #eee; border-radius: 8px; text-decoration: none; color: #000;
    }
    .nav-buttons a:hover { background: #ddd; }
  </style>
</head>
<body>
  <h1>Trunk Impairment Scale (TIS)</h1>
  <p>Beurteilung der Rumpfkontrolle bei neurologischen Patient*innen. Dynamische Struktur: bei bestimmten Antworten wird die Testung automatisch beendet.</p>

  <form id="tisForm">
    <div id="questions"></div>
    <button type="button" onclick="calculateTIS()">‚úÖ Score berechnen</button>
    <button type="button" onclick="generatePDF()">üìÑ Als PDF speichern</button>
  </form>

  <div id="result"></div>

  <div class="nav-buttons">
    <a href="standard.html">‚¨ÖÔ∏è Zur√ºck zu Standard-Assessments</a>
    <a href="index.html">üè† Zur Startseite</a>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const items = [
      { text: "1. Patient h√§lt die Ausgangsposition ohne Unterst√ºtzung f√ºr 10 Sekunden.", options: [{ label: "Ja", value: 2 }, { label: "Nein", value: 0 }] },
      { text: "2. Therapeut kreuzt das nicht-betroffene Bein √ºber das hemiplegische.", options: [
        { label: "F√§llt oder kann Sitzposition ohne Armst√ºtze nicht halten", value: 0 },
        { label: "H√§lt Sitzposition f√ºr 10 Sekunden", value: 2 }
      ]},
      { text: "3. Patient kreuzt selbst das nicht-betroffene Bein √ºber das hemiplegische.", options: [
        { label: "F√§llt", value: 0 },
        { label: "Kann ohne Armhilfe nicht kreuzen", value: 1 },
        { label: "Kreuzt mit Rumpfverschiebung oder Handhilfe", value: 2 },
        { label: "Kreuzt ohne Rumpfverschiebung oder Hilfe", value: 3 }
      ]},
      { text: "4. Ellbogen hemiplegische Seite ber√ºhrt Tisch / Bett ‚Äì R√ºckkehr zur Ausgangsposition.", options: [
        { label: "F√§llt oder ben√∂tigt Armst√ºtze oder Ellbogen ber√ºhrt nicht", value: 0 },
        { label: "Bewegt sich aktiv ohne Hilfe, Ellbogen ber√ºhrt", value: 1 }
      ]},
      { text: "5. Wiederholung von 4 ‚Äì beurteilen von Verk√ºrzung / Verl√§ngerung.", options: [
        { label: "Keine oder gegenteilige Bewegung", value: 0 },
        { label: "Angemessene Verk√ºrzung / Verl√§ngerung", value: 1 }
      ]},
      { text: "6. Wiederholung von 4 ‚Äì beurteilen von Kompensation.", options: [
        { label: "Kompensation durch Arm, H√ºfte, Knie oder Fu√ü", value: 0 },
        { label: "Bewegung ohne Kompensation", value: 1 }
      ]},
      { text: "7. Ellbogen nicht-betroffene Seite ber√ºhrt Tisch / Bett ‚Äì R√ºckkehr zur Ausgangsposition.", options: [
        { label: "F√§llt oder ben√∂tigt Armst√ºtze oder Ellbogen ber√ºhrt nicht", value: 0 },
        { label: "Bewegt sich aktiv ohne Hilfe, Ellbogen ber√ºhrt", value: 1 }
      ]},
      { text: "8. Wiederholung von 7 ‚Äì Verk√ºrzung / Verl√§ngerung", options: [
        { label: "Keine oder gegenteilige Bewegung", value: 0 },
        { label: "Angemessene Verk√ºrzung / Verl√§ngerung", value: 1 }
      ]},
      { text: "9. Wiederholung von 7 ‚Äì Kompensation", options: [
        { label: "Kompensation", value: 0 },
        { label: "Ohne Kompensation", value: 1 }
      ]},
      { text: "10. Becken an hemiplegischer Seite wird angehoben und kehrt zur√ºck", options: [
        { label: "Keine oder gegenteilige Bewegung", value: 0 },
        { label: "Angemessene Verk√ºrzung / Verl√§ngerung", value: 1 }
      ]},
      { text: "11. Wiederholung von 10 ‚Äì Kompensation", options: [
        { label: "Kompensation durch Arm oder Fu√ü", value: 0 },
        { label: "Bewegung ohne Kompensation", value: 1 }
      ]},
      { text: "12. Becken an nicht-betroffener Seite wird angehoben und kehrt zur√ºck", options: [
        { label: "Keine oder gegenteilige Bewegung", value: 0 },
        { label: "Angemessene Verk√ºrzung / Verl√§ngerung", value: 1 }
      ]},
      { text: "13. Wiederholung von 12 ‚Äì Kompensation", options: [
        { label: "Kompensation", value: 0 },
        { label: "Ohne Kompensation", value: 1 }
      ]},
      { text: "14. Oberk√∂rperrotation 6√ó (hemiplegische Seite zuerst, Kopf fixiert)", options: [
        { label: "Hemiplegische Seite nicht 3√ó bewegt", value: 0 },
        { label: "Asymmetrische Rotation", value: 1 },
        { label: "Symmetrische Rotation", value: 2 }
      ]},
      { text: "15. Wiederholung von 14 in 6 Sekunden", options: [
        { label: "Asymmetrische Rotation", value: 0 },
        { label: "Symmetrische Rotation", value: 1 }
      ]},
      { text: "16. Unterk√∂rperrotation 6√ó (hemiplegische Seite zuerst, Oberk√∂rper fixiert)", options: [
        { label: "Hemiplegische Seite nicht 3√ó bewegt", value: 0 },
        { label: "Asymmetrische Rotation", value: 1 },
        { label: "Symmetrische Rotation", value: 2 }
      ]},
      { text: "17. Wiederholung von 16 in 6 Sekunden", options: [
        { label: "Asymmetrische Rotation", value: 0 },
        { label: "Symmetrische Rotation", value: 1 }
      ]}
    ];

    function renderForm() {
      const container = document.getElementById("questions");
      items.forEach((item, i) => {
        const block = document.createElement("div");
        block.className = "question-block";
        block.id = "qblock" + i;
        const options = item.options.map(o => `<option value="${o.value}">${o.label}</option>`).join("");
        block.innerHTML = `
          <div class="question">${item.text}</div>
          <select name="q${i}" onchange="handleDynamic(${i})">
            <option value="" disabled selected>Antwort ausw√§hlen</option>
            ${options}
          </select>`;
        container.appendChild(block);
      });
    }

    function handleDynamic(index) {
      if (index === 0) {
        const val = parseInt(document.querySelector(`select[name='q0']`).value);
        for (let i = 1; i < items.length; i++) {
          document.getElementById(`qblock${i}`).style.display = val === 0 ? "none" : "block";
        }
        if (val === 0) {
          document.getElementById("result").innerText = "Test abgebrochen nach Item 1 ‚Äì Punktzahl: 0";
        } else {
          document.getElementById("result").innerText = "";
        }
      }
    }

    function calculateTIS() {
      const val0 = parseInt(document.querySelector("select[name='q0']").value);
      if (val0 === 0) return;

      let score = 0;
      for (let i = 0; i < items.length; i++) {
        const sel = document.querySelector(`select[name='q${i}']`);
        if (sel && sel.value !== "") {
          score += parseInt(sel.value);
        }
      }

      document.getElementById("result").innerText = `Gesamtscore: ${score} Punkte\n(max. 21 Punkte ‚Äì Statisch: 5 ¬∑ Dynamisch: 10 ¬∑ Koordination: 6)`;
    }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;

      doc.setFontSize(16);
      doc.text("Trunk Impairment Scale ‚Äì Auswertung", 10, y);
      y += 10;

      for (let i = 0; i < items.length; i++) {
        const sel = document.querySelector(`select[name='q${i}']`);
        if (!sel || sel.selectedIndex < 0) continue;
        const label = sel.options[sel.selectedIndex].text;
        doc.setFontSize(12);
        doc.text(`${i + 1}. ${items[i].text}`, 10, y);
        y += 6;
        doc.text(`Antwort: ${label}`, 10, y);
        y += 10;
        if (y > 270) {
          doc.addPage(); y = 10;
        }
      }

      const res = document.getElementById("result").innerText;
      if (res) {
        doc.setFontSize(14);
        doc.text(res, 10, y);
      }

      window.open(doc.output("bloburl"), "_blank");
    }

    renderForm();
  </script>
</body>
</html>


