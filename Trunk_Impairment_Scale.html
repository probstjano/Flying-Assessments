<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trunk Impairment Scale</title>
  <style>
    body { font-family: sans-serif; margin: 20px; max-width: 800px; }
    .item-block { margin-bottom: 1rem; }
    select { width: 100%; padding: 8px; font-size: 16px; }
    button { margin-top: 20px; padding: 10px 15px; font-size: 16px; }
    #result { margin-top: 20px; font-weight: bold; white-space: pre-line; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Trunk Impairment Scale (TIS)</h1>
  <p>Der Test wird automatisch abgebrochen, wenn die erste statische Sitzbalance (Item 1) nicht erfüllt ist.</p>

  <form id="tisForm">
    <div id="items"></div>
    <button type="button" onclick="calculateTIS()">✅ Score berechnen</button>
  </form>

  <div id="result"></div>

  <script>
    const items = [
      { id: "s1", text: "Item 1 – Ausgangsposition ohne Unterstützung 10 Sek. halten", options: ["0 – Nein", "2 – Ja"], section: "static" },
      { id: "s2", text: "Item 2 – Therapeut kreuzt nicht-betroffenes Bein über betroffenes", options: ["0 – Fällt oder braucht Armstütze", "2 – 10 Sek. stabil"], dependsOn: "s1", requiredValue: "2" },
      { id: "s3", text: "Item 3 – Patient kreuzt selbst das nicht-betroffene Bein über das betroffene", options: ["0 – Fällt", "1 – Schafft es nicht ohne Armstütze", "2 – Mit Hilfe oder Rumpfverschiebung", "3 – Ohne Hilfe, ohne Verschiebung"], dependsOn: "s1", requiredValue: "2" },

      { id: "d1", text: "Item 4 – Mit betroffenem Ellbogen Tisch/Bett berühren", options: ["0 – Fällt oder keine Berührung", "1 – Führt aus"], dependsOn: "s1", requiredValue: "2" },
      { id: "d2", text: "Item 5 – Wiederholung: korrektes Verkürzen/Verlängern?", options: ["0 – Nein", "1 – Ja"], dependsOn: "d1", requiredValue: "1" },
      { id: "d3", text: "Item 6 – Wiederholung: ohne Kompensation?", options: ["0 – Mit Kompensation", "1 – Ohne Kompensation"], dependsOn: "d2", requiredValue: "1" },

      { id: "d4", text: "Item 7 – Mit nicht-betroffenem Ellbogen Tisch/Bett berühren", options: ["0 – Fällt oder keine Berührung", "1 – Führt aus"], dependsOn: "s1", requiredValue: "2" },
      { id: "d5", text: "Item 8 – Wiederholung: korrektes Verkürzen/Verlängern?", options: ["0 – Nein", "1 – Ja"], dependsOn: "d4", requiredValue: "1" },
      { id: "d6", text: "Item 9 – Wiederholung: ohne Kompensation?", options: ["0 – Mit Kompensation", "1 – Ohne Kompensation"], dependsOn: "d5", requiredValue: "1" },

      { id: "d7", text: "Item 10 – Becken an betroffener Seite anheben", options: ["0 – Keine Bewegung", "1 – Korrekt"], dependsOn: "s1", requiredValue: "2" },
      { id: "d8", text: "Item 11 – Wiederholung: ohne Kompensation?", options: ["0 – Mit Kompensation", "1 – Ohne Kompensation"], dependsOn: "d7", requiredValue: "1" },

      { id: "d9", text: "Item 12 – Becken an nicht-betroffener Seite anheben", options: ["0 – Keine Bewegung", "1 – Korrekt"], dependsOn: "s1", requiredValue: "2" },

      { id: "c1", text: "Item 13 – Oberkörperrotation 6x, Hemiseite zuerst", options: ["0 – Nicht 3x bewegt", "1 – Asymmetrisch", "2 – Symmetrisch"], dependsOn: "s1", requiredValue: "2" },
      { id: "c2", text: "Item 14 – Wiederholung in 6 Sek.", options: ["0 – Asymmetrisch", "1 – Symmetrisch"], dependsOn: "c1", requiredValue: "2" },
      { id: "c3", text: "Item 15 – Unterkörperrotation 6x, Hemiseite zuerst", options: ["0 – Nicht 3x bewegt", "1 – Asymmetrisch", "2 – Symmetrisch"], dependsOn: "s1", requiredValue: "2" },
      { id: "c4", text: "Item 16 – Wiederholung in 6 Sek.", options: ["0 – Asymmetrisch", "1 – Symmetrisch"], dependsOn: "c3", requiredValue: "2" },
    ];

    function renderForm() {
      const container = document.getElementById("items");
      items.forEach(item => {
        const block = document.createElement("div");
        block.className = "item-block";
        block.id = `block-${item.id}`;

        if (item.dependsOn) block.classList.add("hidden");

        const optionsHTML = item.options.map(opt => {
          const val = parseInt(opt.split("–")[0]);
          return `<option value="${val}">${opt}</option>`;
        }).join("");

        block.innerHTML = `
          <label>${item.text}</label>
          <select id="${item.id}" onchange="updateVisibility()">
            <option value="">Antwort auswählen</option>
            ${optionsHTML}
          </select>`;
        container.appendChild(block);
      });
    }

    function updateVisibility() {
      items.forEach(item => {
        if (!item.dependsOn) return;
        const condition = document.getElementById(item.dependsOn)?.value;
        const block = document.getElementById(`block-${item.id}`);
        if (condition === item.requiredValue) {
          block.classList.remove("hidden");
        } else {
          block.classList.add("hidden");
          document.getElementById(item.id).value = "";
        }
      });
    }

    function calculateTIS() {
      const s1 = document.getElementById("s1").value;
      if (s1 !== "2") {
        document.getElementById("result").innerText = "Test abgebrochen: Startposition nicht gehalten.\nGesamtscore: 0 / 21";
        return;
      }

      let score = 0;
      items.forEach(item => {
        const el = document.getElementById(item.id);
        if (!el || el.classList.contains("hidden") || el.value === "") return;
        score += parseInt(el.value);
      });

      document.getElementById("result").innerText = `Gesamtscore: ${score} / 21`;
    }

    renderForm();
  </script>
</body>
</html>
