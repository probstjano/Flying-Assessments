<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Berg Balance Skala (BBS)</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; font-size: 16px; max-width: 1000px; }
    h1 { margin-bottom: 0.5rem; }
    .question-block { margin-bottom: 1.5rem; }
    .question { font-weight: bold; margin-bottom: 0.5rem; }
    select, input[type="number"] { width: 100%; padding: 8px; font-size: 16px; margin-bottom: 1rem; }
    button { margin-top: 20px; padding: 10px 15px; font-size: 16px; }
    #result { margin-top: 2rem; font-weight: bold; white-space: pre-line; }
    #normInfo { margin-top: 1rem; font-size: 0.9em; color: #333; }
    #normBlock { display: none; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Berg Balance Skala (BBS)</h1>
  <p>Zur Einsch√§tzung des Gleichgewichts und Sturzrisikos. Bitte w√§hlen Sie f√ºr jedes Item die passende Bewertung.</p>

  <button type="button" id="toggleBtn" onclick="toggleForm()">üëâ Zur Kurzversion (7 Items) wechseln</button>

  <form id="bbsForm">
    <div id="questions"></div>
    <button type="button" onclick="calculateBBS()">‚úÖ Score berechnen</button>

    <div id="normBlock">
      <label for="age">Alter der getesteten Person:</label>
      <input type="number" id="age" value="70" min="0" max="120" />
      <button type="button" onclick="toggleNorm()">üìä Normwerte / Cut-Offs anzeigen</button>
    </div>

    <button type="button" onclick="generatePDF()">üìÑ PDF erstellen</button>
  </form>

  <div id="result"></div>
  <div id="normInfo"></div>

  <script>
    const fullQuestions = [
      { text: "Vom Sitzen zum Stehen", options: [
        "4 kann aufstehen ohne die H√§nde einzusetzen und sich selbstst√§ndig stabilisieren",
        "3 kann selbstst√§ndig mit Einsatz der H√§nde aufstehen",
        "2 kann nach einigen Versuchen mit Einsatz der H√§nde aufstehen",
        "1 braucht minimale Hilfe zum Aufstehen oder zum Stabilisieren",
        "0 braucht m√§√üige bis maximale Hilfe um aufzustehen"
      ]},
      { text: "Stehen ohne Unterst√ºtzung", options: [
        "4 kann zwei Minuten sicher stehen",
        "3 kann zwei Minuten unter Supervision stehen",
        "2 kann 30 Sek. ohne Unterst√ºtzung stehen",
        "1 braucht einige Versuche, um 30 Sekunden ohne Unterst√ºtzung zu stehen",
        "0 kann nicht ohne Unterst√ºtzung 30 Sekunden stehen"
      ]},
      { text: "Sitzen ohne R√ºckenlehne", options: [
        "4 kann sicher und stabil zwei Minuten sitzen",
        "3 kann zwei Minuten unter Supervision sitzen",
        "2 kann 30 Sekunden sitzen",
        "1 kann 10 Sekunden sitzen",
        "0 kann nicht ohne Unterst√ºtzung 10 Sekunden sitzen"
      ]},
      { text: "Vom Stehen zum Sitzen", options: [
        "4 setzt sich sicher mit minimalem Einsatz der H√§nde hin",
        "3 kontrolliert das Hinsetzen mit den H√§nden",
        "2 ber√ºhrt mit R√ºckseite der Beine den Stuhl, um das Hinsetzen zu kontrollieren",
        "1 setzt sich selbst√§ndig aber unkontrolliert hin",
        "0 braucht Hilfe um sich hinzusetzen"
      ]},
      { text: "Transfer", options: [
        "4 sicher mit minimalem Einsatz der H√§nde",
        "3 sicher, aber mit Einsatz der H√§nde",
        "2 mit Anweisung und/oder Supervision",
        "1 mit Hilfe einer Person",
        "0 mit zwei Personen oder st√§ndiger Unterst√ºtzung"
      ]},
      { text: "Stehen mit geschlossenen Augen", options: [
        "4 zehn Sekunden sicher",
        "3 zehn Sekunden unter Supervision",
        "2 drei Sekunden",
        "1 steht stabil, aber nicht mit geschlossenen Augen",
        "0 braucht Hilfe"
      ]},
      { text: "Stehen mit F√º√üen zusammen", options: [
        "4 1 Minute sicher",
        "3 1 Minute unter Supervision",
        "2 30 Sekunden",
        "1 15 Sekunden mit Hilfe",
        "0 nicht m√∂glich"
      ]},
      { text: "Nach vorne greifen", options: [
        "4 mehr als 25 cm",
        "3 mehr als 12 cm",
        "2 mehr als 5 cm",
        "1 weniger als 5 cm",
        "0 Gleichgewichtsverlust, Hilfe n√∂tig"
      ]},
      { text: "Gegenstand vom Boden aufheben", options: [
        "4 sicher",
        "3 mit √úberwachung",
        "2 mit Hilfe oder anderer Technik",
        "1 nur mit Unterst√ºtzung",
        "0 nicht m√∂glich, Gleichgewichtsverlust"
      ]},
      { text: "Umdrehen √ºber Schulter", options: [
        "4 sicher nach beiden Seiten",
        "3 unter Supervision",
        "2 nur eine Seite sicher",
        "1 unsicher",
        "0 Gleichgewichtsverlust"
      ]},
      { text: "360¬∞ drehen", options: [
        "4 sicher in < 4 Sekunden",
        "3 sicher in > 4 Sekunden",
        "2 mit vielen Schritten",
        "1 mit Hilfe",
        "0 nicht m√∂glich"
      ]},
      { text: "Schritt vorw√§rts", options: [
        "4 sicher und kontrolliert",
        "3 unter Supervision",
        "2 leicht unsicher oder leicht gest√ºtzt",
        "1 mit Unterst√ºtzung",
        "0 nicht m√∂glich"
      ]},
      { text: "Tandemstand", options: [
        "4 30 Sekunden sicher",
        "3 30 Sekunden mit Supervision",
        "2 unter 30 Sekunden",
        "1 mit Hilfe",
        "0 nicht m√∂glich"
      ]},
      { text: "Einbeinstand", options: [
        "4 10 Sekunden sicher",
        "3 10 Sekunden mit Supervision",
        "2 5 Sekunden",
        "1 unter 3 Sekunden",
        "0 nicht m√∂glich"
      ]}
    ];

   const shortIndexes = [0, 5, 7, 8, 9, 12, 13];
    let useShort = false;
    let currentScore = null;
    let normVisible = false;

    function toggleForm() {
      useShort = !useShort;
      document.getElementById("toggleBtn").innerText = useShort
        ? "üîÅ Zur Vollversion (14 Items) wechseln"
        : "üëâ Zur Kurzversion (7 Items) wechseln";
      renderForm();
      document.getElementById("result").innerText = "";
      document.getElementById("normInfo").innerText = "";
      document.getElementById("normBlock").style.display = "none";
      normVisible = false;
    }

    function renderForm() {
      const container = document.getElementById("questions");
      container.innerHTML = "";
      const items = useShort ? shortIndexes.map(i => fullQuestions[i]) : fullQuestions;

      items.forEach((q, i) => {
        const fullIndex = useShort ? shortIndexes[i] : i;
        const block = document.createElement("div");
        block.className = "question-block";
        const options = q.options.map((textOpt, idx) =>
          `<option value="${4 - idx}">${textOpt}</option>`).join("");
        block.innerHTML = `
          <div class="question">${fullIndex + 1}. ${q.text}</div>
          <select name="q${fullIndex}" required>
            <option value="" disabled selected>Antwort ausw√§hlen</option>
            ${options}
          </select>
        `;
        container.appendChild(block);
      });
    }

    function calculateNorm(age) {
      if (age < 70) return 56;
      return Math.round((56 - ((age - 70) * 0.7)) * 10) / 10;
    }

    function calculateBBS() {
      const items = useShort ? shortIndexes.map(i => fullQuestions[i]) : fullQuestions;
      let total = 0;
      for (let idx = 0; idx < items.length; idx++) {
        const fullIndex = useShort ? shortIndexes[idx] : idx;
        const sel = document.querySelector(`select[name='q${fullIndex}']`);
        if (!sel || sel.value === "") return alert("Bitte alle Fragen beantworten.");
        total += parseInt(sel.value);
      }
      const max = useShort ? 28 : 56;
      currentScore = total;
      document.getElementById("result").innerText = `BBS Gesamtscore: ${total} / ${max}`;
      if (!useShort) document.getElementById("normBlock").style.display = "block";
      document.getElementById("normInfo").innerText = "";
      normVisible = false;
    }

    function toggleNorm() {
      if (!normVisible) {
        const age = parseInt(document.getElementById("age").value);
        const norm = calculateNorm(age);
        document.getElementById("result").innerText += `\nErwarteter Normwert (Alter ${age}): ${norm}`;
        document.getElementById("normInfo").innerText =
          "Ein 0-j√§hriger, selbstst√§ndig lebender Mensch ohne beeintr√§chtigende Erkrankungen erreicht wahrscheinlich einen Maximalwert von 56 Punkten auf der BBS. Ab dem 1. Lebensjahr nimmt der mittlere Wert um ca. 0,7 Punkte pro Jahr ab und die Streuung der Werte steigt an.";
        normVisible = true;
      } else {
        document.getElementById("result").innerText = `BBS Gesamtscore: ${currentScore} / ${useShort ? 28 : 56}`;
        document.getElementById("normInfo").innerText = "";
        normVisible = false;
      }
    }

    renderForm();
  </script>
</body>
</html>

