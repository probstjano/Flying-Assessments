<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Berg Balance Skala (BBS)</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; font-size: 16px; max-width: 1000px; }
    h1 { margin-bottom: 0.5rem; }
    .question-block { margin-bottom: 1.5rem; }
    .question { font-weight: bold; margin-bottom: 0.5rem; }
    select, option, input[type="number"] { width: 100%; padding: 8px; font-size: 16px; margin-bottom: 1rem; }
    button { margin-top: 20px; padding: 10px 15px; font-size: 16px; }
    #result { margin-top: 2rem; font-weight: bold; white-space: pre-line; }
    #normInfo { margin-top: 1rem; font-size: 0.9em; color: #333; }
  </style>
</head>
<body>
  <h1>Berg Balance Skala (BBS)</h1>
  <p>Zur EinschÃ¤tzung des Gleichgewichts und Sturzrisikos. Bitte wÃ¤hlen Sie fÃ¼r jedes Item die passende Bewertung.</p>

  <label for="age">Alter der getesteten Person:</label>
  <input type="number" id="age" value="70" min="0" max="120" />

  <button type="button" id="toggleBtn" onclick="toggleForm()">ðŸ‘‰ Zur Kurzversion (7 Items) wechseln</button>

  <form id="bbsForm">
    <div id="questions"></div>
    <button type="button" onclick="calculateBBS()">âœ… Score berechnen</button>
    <button type="button" onclick="generatePDF()">ðŸ“„ PDF erstellen</button>
  </form>

  <div id="result"></div>
  <div id="normInfo"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const fullQuestions =  [
      { text: "Vom Sitzen zum Stehen", options: [
        "4 kann aufstehen ohne die HÃ¤nde einzusetzen und sich selbststÃ¤ndig stabilisieren",
        "3 kann selbststÃ¤ndig mit Einsatz der HÃ¤nde aufstehen",
        "2 kann nach einigen Versuchen mit Einsatz der HÃ¤nde aufstehen",
        "1 braucht minimale Hilfe zum Aufstehen oder zum Stabilisieren",
        "0 braucht mÃ¤ÃŸige bis maximale Hilfe um aufzustehen"
      ]},
      { text: "Stehen ohne UnterstÃ¼tzung", options: [
        "4 kann zwei Minuten sicher stehen",
        "3 kann zwei Minuten unter Supervision stehen",
        "2 kann 30 Sek. ohne UnterstÃ¼tzung stehen",
        "1 braucht einige Versuche, um 30 Sekunden ohne UnterstÃ¼tzung zu stehen",
        "0 kann nicht ohne UnterstÃ¼tzung 30 Sekunden stehen"
      ]},
      { text: "Sitzen ohne RÃ¼ckenlehne, aber mit beiden FÃ¼ÃŸen auf dem Boden oder auf einer FuÃŸbank", options: [
        "4 kann sicher und stabil zwei Minuten sitzen",
        "3 kann zwei Minuten unter Supervision sitzen",
        "2 kann 30 Sekunden sitzen",
        "1 kann 10 Sekunden sitzen",
        "0 kann nicht ohne UnterstÃ¼tzung 10 Sekunden sitzen"
      ]},
      { text: "Vom Stehen zum Sitzen", options: [
        "4 setzt sich sicher mit minimalem Einsatz der HÃ¤nde hin",
        "3 kontrolliert das Hinsetzen mit den HÃ¤nden",
        "2 berÃ¼hrt mit RÃ¼ckseite der Beine den Stuhl, um das Hinsetzen zu kontrollieren",
        "1 setzt sich selbstÃ¤ndig aber unkontrolliert hin",
        "0 braucht Hilfe um sich hinzusetzen"
      ]},
      { text: "Transfer", options: [
        "4 kann den Transfer sicher mit minimalem Einsatz der HÃ¤nde ausfÃ¼hren",
        "3 kann den Transfer sicher ausfÃ¼hren, muss aber die HÃ¤nde einsetzen",
        "2 kann den Transfer mit verbaler Anweisung und/oder unter Supervision ausfÃ¼hren",
        "1 braucht eine Person zur Hilfestellung",
        "0 braucht zwei Personen zur Hilfestellung oder Supervision um sicher zu sein"
      ]},
      { text: "Stehen mit geschlossenen Augen ohne UnterstÃ¼tzung", options: [
        "4 kann zehn Sekunden sicher stehen",
        "3 kann zehn Sekunden unter Supervision stehen",
        "2 kann drei Sekunden stehen",
        "1 kann nicht die Augen drei Sekunden geschlossen halten, steht aber stabil",
        "0 braucht Hilfe, um nicht zu fallen"
      ]},
      { text: "Stehen mit FÃ¼ÃŸen dicht nebeneinander", options: [
        "4 kann selbstÃ¤ndig FÃ¼ÃŸe nebeneinander stellen und 1 Minute sicher stehen",
        "3 kann selbstÃ¤ndig FÃ¼ÃŸe nebeneinander stellen und unter Supervision 1 Minute stehen",
        "2 kann selbstÃ¤ndig FÃ¼ÃŸe nebeneinander stellen und die Position 30 Sekunden halten",
        "1 braucht Hilfe um die Position einzunehmen, kann aber 15 Sekunden mit geschlossenen FÃ¼ÃŸen stehen",
        "0 braucht Hilfe um die Position einzunehmen, kann diese nicht fÃ¼r 15 Sekunden halten"
      ]},
      { text: "Nach vorne greifen mit ausgestrecktem Arm im Stand", options: [
        "4 kann mehr als 25 cm ohne zu fallen nach vorne greifen",
        "3 kann mehr als 12 cm nach vorne greifen",
        "2 kann mehr als 5 cm nach vorne greifen",
        "1 kann nur minimal nach vorne greifen (weniger als 5 cm)",
        "0 verliert das Gleichgewicht und benÃ¶tigt Hilfe, um nicht zu fallen"
      ]},
      { text: "Gegenstand vom Boden aufheben im Stand", options: [
        "4 kann sicher einen Gegenstand vom Boden aufheben",
        "3 kann den Gegenstand aufheben, benÃ¶tigt jedoch Ãœberwachung",
        "2 kann den Gegenstand mit Hilfe oder Ã„nderung der KÃ¶rperposition aufheben",
        "1 kann den Gegenstand nur mit UnterstÃ¼tzung aufheben",
        "0 ist nicht in der Lage, den Gegenstand aufzuheben und verliert das Gleichgewicht"
      ]},
      { text: "Stehen, sich umsehen Ã¼ber rechte und linke Schulter", options: [
        "4 kann sich sicher nach beiden Seiten umsehen",
        "3 kann sich nach beiden Seiten unter Supervision umsehen",
        "2 kann sich nur zu einer Seite sicher umsehen",
        "1 zeigt Angst oder Unsicherheit beim Umdrehen",
        "0 kann sich nicht sicher umsehen und verliert das Gleichgewicht"
      ]},
      { text: "Sich um 360Â° drehen", options: [
        "4 kann sicher eine komplette Drehung in weniger als 4 Sekunden ausfÃ¼hren",
        "3 kann sicher eine komplette Drehung in mehr als 4 Sekunden ausfÃ¼hren",
        "2 benÃ¶tigt mehrere Schritte um die Drehung zu vollenden",
        "1 benÃ¶tigt UnterstÃ¼tzung bei der Drehung",
        "0 ist nicht in der Lage sich sicher zu drehen"
      ]},
      { text: "Einen Schritt vorwÃ¤rts machen (rechte und linke FÃ¼ÃŸe abwechselnd) und stehen bleiben", options: [
        "4 kann einen Schritt sicher und kontrolliert ausfÃ¼hren",
        "3 kann einen Schritt unter Supervision ausfÃ¼hren",
        "2 zeigt Unsicherheit oder leichte UnterstÃ¼tzung erforderlich",
        "1 benÃ¶tigt UnterstÃ¼tzung beim Schritt",
        "0 kann keinen Schritt ausfÃ¼hren, ohne das Gleichgewicht zu verlieren"
      ]},
      { text: "Stehen mit einem FuÃŸ vor dem anderen (Tandemstellung)", options: [
        "4 kann 30 Sekunden sicher stehen",
        "3 kann 30 Sekunden unter Supervision stehen",
        "2 kann weniger als 30 Sekunden stehen",
        "1 benÃ¶tigt Hilfe, um die Position einzunehmen oder zu halten",
        "0 kann die Position nicht einnehmen oder halten"
      ]},
      { text: "Auf einem Bein stehen", options: [
        "4 kann 10 Sekunden sicher stehen",
        "3 kann 10 Sekunden unter Supervision stehen",
        "2 kann 5 Sekunden stehen",
        "1 kann weniger als 3 Sekunden stehen",
        "0 kann die Position nicht einnehmen oder halten"
      ]}
    ];

    const shortIndexes = [0, 5, 7, 8, 9, 12, 13];
    let useShort = false;

    function toggleForm() {
      useShort = !useShort;
      document.getElementById("toggleBtn").innerText = useShort
        ? "ðŸ” Zur Vollversion (14 Items) wechseln"
        : "ðŸ‘‰ Zur Kurzversion (7 Items) wechseln";
      renderForm();
      calculateBBS(); // neu berechnen nach Wechsel
    }

    function renderForm() {
      const container = document.getElementById("questions");
      container.innerHTML = "";
      const items = useShort ? shortIndexes.map(i => fullQuestions[i]) : fullQuestions;

      items.forEach((q, i) => {
        const block = document.createElement("div");
        block.className = "question-block";
        const options = q.options.map((textOpt, idx) => {
          return `<option value="${4 - idx}">${textOpt}</option>`;
        }).join("");
        block.innerHTML = `
          <div class="question">${useShort ? shortIndexes[i] + 1 : i + 1}. ${q.text}</div>
          <select name="q${useShort ? shortIndexes[i] : i}" required>
            <option value="" disabled selected>Antwort auswÃ¤hlen</option>
            ${options}
          </select>
        `;
        container.appendChild(block);
      });
    }

    function calculateNorm(age) {
      if (age < 70) return 56;
      return Math.round((56 - (age - 70) * 0.7) * 10) / 10;
    }

    function calculateBBS() {
      const selects = document.querySelectorAll("select[name^='q']");
      let total = 0;
      for (let sel of selects) {
        const val = parseInt(sel.value);
        if (isNaN(val)) return; // keine Alert, um Nutzbarkeit bei Wechsel zu verbessern
        total += val;
      }

      const max = useShort ? 28 : 56;
      const age = parseInt(document.getElementById("age").value);
      const norm = useShort ? "â€“" : calculateNorm(age);

      document.getElementById("result").innerText =
        `BBS Gesamtscore: ${total} / ${max}` + (useShort ? "" : `\nErwarteter Normwert (Alter ${age}): ${norm}`);

      document.getElementById("normInfo").innerText = useShort ? "" :
        "Ein 0-jÃ¤hriger, selbststÃ¤ndig lebender Mensch ohne beeintrÃ¤chtigende Erkrankungen erreicht wahrscheinlich einen Maximalwert von 56 Punkten auf der BBS. Ab dem 1. Lebensjahr nimmt der mittlere Wert um ca. 0,7 Punkte pro Jahr ab und die Streuung der Werte steigt an.";
    }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const items = useShort ? shortIndexes.map(i => fullQuestions[i]) : fullQuestions;
      const selects = document.querySelectorAll("select[name^='q']");
      const age = parseInt(document.getElementById("age").value);
      const norm = useShort ? "â€“" : calculateNorm(age);

      let doc = new jsPDF();
      let y = 10;
      let total = 0;

      doc.setFontSize(16);
      doc.text(`BBS ${useShort ? "Kurzversion" : "Vollversion"} â€“ Auswertung`, 10, y);
      y += 10;

      items.forEach((q, i) => {
        const sel = selects[i];
        const val = parseInt(sel.value);
        const label = sel.options[sel.selectedIndex].text;
        if (!isNaN(val)) total += val;
        doc.setFontSize(12);
        doc.text(`${useShort ? shortIndexes[i] + 1 : i + 1}. ${q.text}`, 10, y);
        y += 6;
        doc.text(`Antwort: ${label}`, 10, y);
        y += 10;
        if (y > 270) {
          doc.addPage();
          y = 10;
        }
      });

      doc.setFontSize(14);
      doc.text(`Gesamtscore: ${total} / ${useShort ? 28 : 56}`, 10, y);
      if (!useShort) {
        y += 7;
        doc.text(`Erwarteter Normwert (Alter ${age}): ${norm}`, 10, y);
        y += 7;
        doc.setFontSize(10);
        doc.text(
          \"Ein 0-jÃ¤hriger, selbststÃ¤ndig lebender Mensch ohne beeintrÃ¤chtigende Erkrankungen erreicht wahrscheinlich einen Maximalwert von 56 Punkten auf der BBS. Ab dem 1. Lebensjahr nimmt der mittlere Wert um ca. 0,7 Punkte pro Jahr ab und die Streuung der Werte steigt an.\",
          10, y, { maxWidth: 180 }
        );
      }

      window.open(doc.output('bloburl'), '_blank');
    }

    renderForm();
  </script>
</body>
</html>

  
