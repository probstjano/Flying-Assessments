<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DEMMI â€“ De Morton Mobility Index</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 10px; font-size: 16px; max-width: 600px; }
    label { display: block; margin: 10px 0 5px; }
    select {
      width: 100%;
      padding: 6px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    button { padding: 10px 15px; font-size: 16px; margin-top: 10px; }
    #result { font-weight: bold; margin-top: 20px; }
    .nav-buttons { margin-top: 30px; }
    .nav-buttons a {
      display: inline-block;
      margin-right: 10px;
      padding: 10px 15px;
      background: #eee;
      border-radius: 8px;
      text-decoration: none;
      color: #000;
    }
    .nav-buttons a:hover { background: #ddd; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>FSMC â€“ Fatigue Skala fÃ¼r Motorik und Kognition</h1>
  <p> AbklÃ¤rung von motorischer und kognitiver Fatigue-Symptomatik bei Patienten mit Multipler Skleorse </p>
  <p> In Cenplex Behandlungsplan als <strong> Messung </strong> vorhanden. Hier eintragen/durchfÃ¼hren und Summen-Scores im Cenplex Ã¼bertragen </p>
  <form id="fsmcForm">
    <div id="questions"></div>
    <button type="button" onclick="calculateFSMC()">âœ… Score berechnen</button>
    <button type="button" onclick="generatePDF()">ðŸ“„ PDF erstellen</button>
  </form>
  <div id="result"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const questions = [
      "Wenn ich mich lÃ¤ngere Zeit konzentriere, erschÃ¶pft es mich schneller als andere Menschen in meinem Alter.",
      "Meine Bewegungen werden im Zustand der ErschÃ¶pfung deutlich ungeschickter und unkoordinierter.",
      "Wegen meiner ErschÃ¶pfungszustÃ¤nde brauche ich heute bei kÃ¶rperliche TÃ¤tigkeiten hÃ¤ufigere und/oder lÃ¤ngere Ruhepausen als frÃ¼her.",
      "Im Zustand der ErschÃ¶pfung bin ich unfÃ¤hig, Entscheidungen zu treffen.",
      "Ich fÃ¼hle mich heute kÃ¶rperlich schneller erschÃ¶pft als frÃ¼her, wenn ich stressige Situationen ausgesetzt bin.",
      "Wegen meinte ErschÃ¶pfungszustÃ¤nde habe ich wesentlich weniger sozialer Kontakte als frÃ¼her.",
      "Wegen meiner ErschÃ¶pfungszustÃ¤nde fÃ¤llt es mir heute schwerer, etwas Neues zu lernen als frÃ¼her.",
      "Berufliche Anforderungen lassen mich geistig schneller erschÃ¶pfen als frÃ¼her.",
      "ErschÃ¶pfungszustÃ¤nde spÃ¼re ich besonders stark in meinen Muskeln.",
      "Bei kÃ¶rperlicher Anstrengung Ã¼ber einen lÃ¤ngeren Zeitraum habe ich mehr MÃ¼he durchzuhalten als frÃ¼her.",
      "Meine KonzentrationsfÃ¤higkeit nimmt bei Stress betrÃ¤chtlich ab.",
      "Im Zustand der ErschÃ¶pfung bin ich weniger motiviert als andere Menschen, TÃ¤tigkeiten zu beginnen, die mit kÃ¶rperlicher Anstrengung verbunden sind.",
      "Mein Denken verlangsamt sich zusehends, wenn es heiss ist.",
      "Meine Bewegungen werden im Zustand der ErschÃ¶pfung eindeutig langsamer.",
      "Wegen meiner ErschÃ¶fpungszustÃ¤nde habe ich heute weniger Lust als frÃ¼her, etwas zu tun, was Nachdenken erfordert.",
      "Wenn sich ein ErschÃ¶pfungszustand einstellt, bin ich Ã¼berhaupt nciht mehr in der Lage, schnell zu reagieren.",
      "Im Zustand der ErschÃ¶pfung, kommen mit bestimmte Worte nicht mehr in den Sinn.",
      "Meine Aufmerksamkeit lÃ¤sst im ErschÃ¶pfungszustand wesentlich schneller nach als frÃ¼her.",
      "Wenn es heiss ist, fÃ¼hle ich mich hauptsÃ¤chlich kÃ¶rperlich extrem schwach und energielos.",
      "Im Zustand der ErschÃ¶pfung nimmt meine Vergesslichkeit merklich zu."
    ];

    const labels = [
      "Trifft gar nicht zu",
      "Trifft wenig zu",
      "Trifft teils zu",
      "Trifft ziemlich zu",
      "Trifft vÃ¶llig zu"
    ];

    const cognitiveIndexes = [0, 3, 6, 7, 10, 12, 14, 16, 17, 19];
    const motorIndexes = [1, 2, 4, 5, 8, 9, 11, 13, 15, 18];

    const container = document.getElementById("questions");
    questions.forEach((text, i) => {
      const block = document.createElement("div");
      block.className = "question-block";
      const options = labels.map((label, idx) => `<option value="${idx + 1}">${label}</option>`).join("");
      block.innerHTML = `
        <div class="question">${i + 1}. ${text}</div>
        <select name="q${i}" required>
          <option value="" disabled selected>Antwort auswÃ¤hlen</option>
          ${options}
        </select>
      `;
      container.appendChild(block);
    });

    function calculateFSMC() {
      let cognitive = 0, motoric = 0;
      for (let i = 0; i < 20; i++) {
        const val = parseInt(document.querySelector(`select[name='q${i}']`)?.value);
        if (!val) return alert("Bitte alle Fragen beantworten.");
        if (cognitiveIndexes.includes(i)) cognitive += val;
        else if (motorIndexes.includes(i)) motoric += val;
      }
      const total = cognitive + motoric;

      const level = (value, thresholds) => {
        if (value >= thresholds[2]) return "Schwere";
        if (value >= thresholds[1]) return "Mittelgradige";
        if (value >= thresholds[0]) return "Leichte";
        return "Keine";
      };

      document.getElementById("result").innerText =
        `FSMC Gesamt: ${total} (${level(total, [43, 53, 63])} Fatigue)\n` +
        `Kognitive Fatigue: ${cognitive} (${level(cognitive, [22, 28, 34])})\n` +
        `Motorische Fatigue: ${motoric} (${level(motoric, [22, 27, 32])})`;
    }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      let doc = new jsPDF();
      let y = 10;

      doc.setFontSize(16);
      doc.text("FSMC â€“ Auswertung", 10, y);
      y += 10;

      let cognitive = 0, motoric = 0;
      questions.forEach((q, i) => {
        const val = parseInt(document.querySelector(`select[name='q${i}']`)?.value);
        if (!val) val = 0;
        if (cognitiveIndexes.includes(i)) cognitive += val;
        else if (motorIndexes.includes(i)) motoric += val;
      });
      const total = cognitive + motoric;

      const level = (value, thresholds) => {
        if (value >= thresholds[2]) return "Schwere";
        if (value >= thresholds[1]) return "Mittelgradige";
        if (value >= thresholds[0]) return "Leichte";
        return "Keine";
      };

      doc.setFontSize(12);
      doc.text(`FSMC Gesamt: ${total} (${level(total, [43, 53, 63])} Fatigue)`, 10, y);
      y += 7;
      doc.text(`Kognitive Fatigue: ${cognitive} (${level(cognitive, [22, 28, 34])})`, 10, y);
      y += 7;
      doc.text(`Motorische Fatigue: ${motoric} (${level(motoric, [22, 27, 32])})`, 10, y);
      y += 10;

      questions.forEach((q, i) => {
        const val = document.querySelector(`select[name='q${i}']`)?.value;
        const label = val ? labels[parseInt(val) - 1] : "-";
        const line = `${i + 1}. ${q}\nAntwort: ${label}`;
        doc.text(line, 10, y);
        y += 10;
        if (y > 280) {
          doc.addPage();
          y = 10;
        }
      });

      window.open(doc.output('bloburl'), '_blank');
    }
  </script>
</body>
</html>
