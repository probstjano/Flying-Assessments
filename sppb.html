<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SPPB</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; font-size: 16px; max-width: 600px; }
    label { display: block; margin-top: 1rem; }
    input, select { width: 100%; padding: 6px; font-size: 16px; margin-bottom: 10px; }
    button { margin-top: 10px; padding: 10px 15px; font-size: 16px; }
    #result, #normwerteSitz, #normwerteSPPB, #normwerteGait {
      font-weight: bold;
      margin-top: 20px;
      white-space: pre-line;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #f0f0f0; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>SPPB â€“ Short Physical Performance Battery</h1>
  <p>Test fÃ¼r physische LeistungsfÃ¤higkeit unterer ExtremitÃ¤ten.</p>
  <p>Eintragen mit Einzelwerte im Cenplex Behandlungsplan unter "Messung".</p>
  <p>
    Detailliertes DurchfÃ¼hrungsprotokoll hier:
    <a href="SPPB_Protokoll.pdf" target="_blank">SPPB Protokoll (PDF)</a>
  </p>
  <p><strong>Nur bei Bedarf hier eintragen</strong> fÃ¼r Infos, Normwerte und Score-Berechnung.</p>

  <form>
    <label><input type="checkbox" id="standZusammen"> FÃ¼ÃŸe zusammen >10s</label>
    <label><input type="checkbox" id="semitandem"> Semitandem >10s</label>
    <label>Tandem-Zeit (Sek.):</label>
    <input type="number" id="tandemZeit" step="0.01">
    <label>Strecke:</label>
    <label><input type="radio" name="strecke" value="3" checked> 3â€¯m</label>
    <label><input type="radio" name="strecke" value="4"> 4â€¯m</label>
    <label>Zeit (Sek.):</label>
    <input type="number" id="gehzeit" step="0.01">
    <label>5x Sitz-Stand (Sek.):</label>
    <input type="number" id="sitzStand" step="0.01">
    <button type="button" onclick="calculateSPPB()">âœ… Score berechnen</button>
  </form>

  <div id="result"></div>

  <div id="ageSection" class="hidden">
    <label>Alter:</label>
    <input type="number" id="age" min="60" max="120">
    <label>Geschlecht:</label>
    <select id="sex">
      <option value="men">MÃ¤nnlich</option>
      <option value="women">Weiblich</option>
    </select>
    <button type="button" onclick="toggleNormsSitz()" id="toggleBtnSitz">ðŸ“Š Normwerte Sitz-Stand anzeigen</button>
    <button type="button" onclick="toggleNormsSPPB()" id="toggleBtnSPPB">ðŸ“Š Normwerte SPPB anzeigen</button>
    <button type="button" onclick="toggleNormsGait()" id="toggleBtnGait">ðŸ“Š Normwerte Gehgeschwindigkeit anzeigen</button>
  </div>

  <div id="normwerteSitz" class="hidden"></div>
  <div id="normwerteSPPB" class="hidden"></div>
  <div id="normwerteGait" class="hidden"></div>

  <script>
    let sitzVisible = false;
    let sppbVisible = false;
    let gaitVisible = false;

    function calculateSPPB() {
      let balance = 0;
      const tandem = parseFloat(document.getElementById("tandemZeit").value);
      if (document.getElementById("standZusammen").checked) balance += 1;
      if (document.getElementById("semitandem").checked) balance += 1;
      if (!isNaN(tandem)) {
        if (tandem >= 3 && tandem < 10) balance += 1;
        else if (tandem >= 10) balance += 2;
      }

      const dist = parseFloat(document.querySelector('input[name="strecke"]:checked').value);
      const gehzeit = parseFloat(document.getElementById("gehzeit").value);
      let speed = 0, gangScore = 0;
      if (!isNaN(dist) && !isNaN(gehzeit) && gehzeit > 0) {
        speed = dist / gehzeit;
        if (speed <= 0.45) gangScore = 1;
        else if (speed <= 0.64) gangScore = 2;
        else if (speed <= 0.82) gangScore = 3;
        else gangScore = 4;
      }

      const sitzZeit = parseFloat(document.getElementById("sitzStand").value);
      let sitzScore = 0;
      if (isNaN(sitzZeit) || sitzZeit > 60) sitzScore = 0;
      else if (sitzZeit > 16.7) sitzScore = 1;
      else if (sitzZeit >= 13.7) sitzScore = 2;
      else if (sitzZeit >= 11.2) sitzScore = 3;
      else sitzScore = 4;

      const total = balance + gangScore + sitzScore;
      const speedText = (!isNaN(speed)) ? speed.toFixed(2) + " m/s" : "-";

      document.getElementById("result").innerText =
        `Gesamt-Score: ${total}/12\nBalance: ${balance}/4\nGang: ${gangScore}/4\n5x Sitz-Stand: ${sitzScore}/4\nGehgeschwindigkeit: ${speedText}\n5x Sitz-Stand Zeit: ${sitzZeit || "-"} s`;

      document.getElementById("ageSection").classList.remove("hidden");
      document.getElementById("normwerteSitz").classList.add("hidden");
      document.getElementById("normwerteSPPB").classList.add("hidden");
      document.getElementById("normwerteGait").classList.add("hidden");

      document.getElementById("toggleBtnSitz").innerText = "ðŸ“Š Normwerte Sitz-Stand anzeigen";
      document.getElementById("toggleBtnSPPB").innerText = "ðŸ“Š Normwerte SPPB anzeigen";
      document.getElementById("toggleBtnGait").innerText = "ðŸ“Š Normwerte Gehgeschwindigkeit anzeigen";

      sitzVisible = false;
      sppbVisible = false;
      gaitVisible = false;
    }

    function toggleNormsSitz() {
      const btn = document.getElementById("toggleBtnSitz");
      const norms = document.getElementById("normwerteSitz");

      if (sitzVisible) {
        norms.classList.add("hidden");
        btn.innerText = "ðŸ“Š Normwerte Sitz-Stand anzeigen";
        sitzVisible = false;
        return;
      }

      const age = parseInt(document.getElementById("age").value, 10);
      const sex = document.getElementById("sex").value;
      const sitzZeit = parseFloat(document.getElementById("sitzStand").value);
      norms.innerHTML = "";

      if (isNaN(age)) {
        norms.innerText = "Bitte zuerst das Alter eingeben.";
        norms.classList.remove("hidden");
        return;
      }

      const norway = {
        men: {
          60: { P5:5.5, P10:5.9, P25:6.9, P50:8.3, P75:9.8, P90:11.5, P95:12.5 },
          65: { P5:5.7, P10:6.2, P25:7.3, P50:8.7, P75:10.2, P90:11.8, P95:12.9 },
          70: { P5:6.1, P10:6.6, P25:7.7, P50:9.3, P75:10.9, P90:12.5, P95:13.9 },
          75: { P5:6.4, P10:7.0, P25:8.3, P50:10.0, P75:12.1, P90:14.0, P95:15.4 },
          80: { P5:6.6, P10:7.5, P25:8.9, P50:10.7, P75:13.5, P90:15.8, P95:17.2 },
          85: { P5:6.9, P10:7.9, P25:9.6, P50:11.5, P75:14.9, P90:17.7, P95:19.0 }
        },
        women: {
          60: { P5:5.8, P10:6.3, P25:7.4, P50:8.9, P75:10.5, P90:12.1, P95:13.2 },
          65: { P5:6.4, P10:7.0, P25:8.2, P50:10.0, P75:11.4, P90:13.3, P95:14.6 },
          70: { P5:7.0, P10:7.7, P25:8.9, P50:10.5, P75:12.4, P90:14.6, P95:16.1 },
          75: { P5:7.4, P10:8.2, P25:9.5, P50:11.2, P75:13.1, P90:15.8, P95:17.4 },
          80: { P5:7.6, P10:8.5, P25:10.0, P50:11.7, P75:13.7, P90:16.8, P95:18.5 },
          85: { P5:7.9, P10:9.0, P25:10.5, P50:12.3, P75:14.3, P90:17.8, P95:19.7 }
        }
      };

      const nearest = [60, 65, 70, 75, 80, 85].reduce((prev, curr) =>
        Math.abs(curr - age) < Math.abs(prev - age) ? curr : prev
      );

      let faster = "-";
      const P = norway[sex][nearest];
      if (!isNaN(sitzZeit)) {
        const percentiles = [5,10,25,50,75,90,95];
        const values = percentiles.map(p => P["P"+p]);
        if (sitzZeit <= values[0]) faster = 95;
        else if (sitzZeit >= values[6]) faster = 5;
        else {
          for (let i = 0; i < values.length - 1; i++) {
            if (sitzZeit >= values[i] && sitzZeit <= values[i+1]) {
              const p0 = percentiles[i], p1 = percentiles[i+1];
              const v0 = values[i], v1 = values[i+1];
              const frac = (sitzZeit - v0) / (v1 - v0);
              faster = Math.round(100 - (p0 + frac * (p1 - p0)));
              break;
            }
          }
        }
      }

      norms.innerHTML += `<h3>Norwegische Referenzwerte zuhause lebende Personen (${nearest} Jahre â€“ ${sex === 'men' ? 'MÃ¤nner' : 'Frauen'})</h3>`;
      norms.innerHTML += `<table><tr><th>Perzentil</th><th>Wert (s)</th></tr>
        ${Object.entries(P).map(([k,v]) => `<tr><td>${k}</td><td>${v}</td></tr>`).join("")}
      </table><p>â†’ Die Zeit ist schneller als bei: <strong>${faster}%</strong> der Vergleichsgruppe.</p>`;

      const bohannon = {
        men: {
          "60â€“69": { mean: "13.3", unable: "15.1%" },
          "70â€“79": { mean: "13.8", unable: "16.2%" },
          "80â€“89": { mean: "15.1", unable: "34.4%" },
          "90+":   { mean: "16.4", unable: "62.5%" }
        },
        women: {
          "60â€“69": { mean: "13.9", unable: "13.7%" },
          "70â€“79": { mean: "15.1", unable: "22.0%" },
          "80â€“89": { mean: "16.9", unable: "46.0%" },
          "90+":   { mean: "18.5", unable: "83.5%" }
        }
      };

      let ageGroup = "90+";
      if (age < 70) ageGroup = "60â€“69";
      else if (age < 80) ageGroup = "70â€“79";
      else if (age < 90) ageGroup = "80â€“89";

      const b = bohannon[sex][ageGroup];
      norms.innerHTML += `<h3>Mittelwert  & Anzeil der Personen die Sitz-Stand Test nich durchfÃ¼hren kÃ¶nnen (GesamtbevÃ¶lkerung inkl. Pflegeheime/Institutionen) â€“ ${ageGroup}</h3>
        <table><tr><th>Geschlecht</th><th>MW (s)</th><th>% nicht fÃ¤hig</th></tr>
        <tr><td>${sex === 'men' ? 'MÃ¤nner' : 'Frauen'}</td><td>${b.mean}</td><td>${b.unable}</td></tr>
      </table>`;

      norms.classList.remove("hidden");
      btn.innerText = "ðŸ“‰ Normwerte sit-stand verbergen";
      sitzVisible = true;
    }

    function toggleNormsSPPB() {
      const btn = document.getElementById("toggleBtnSPPB");
      const norms = document.getElementById("normwerteSPPB");
      if (sppbVisible) {
        norms.classList.add("hidden");
        btn.innerText = "ðŸ“Š Normwerte SPPB anzeigen";
        sppbVisible = false;
        return;
      }

      const age = parseInt(document.getElementById("age").value, 10);
      const sex = document.getElementById("sex").value;
      const sitzZeit = parseFloat(document.getElementById("sitzStand").value);
      norms.innerHTML = "";

      if (isNaN(age)) {
        norms.innerText = "Bitte zuerst das Alter eingeben.";
        norms.classList.remove("hidden");
        return;
      }

      const sppb  = {
        men: {
          60: { P5:5.5, P10:5.9, P25:6.9, P50:8.3, P75:9.8, P90:11.5, P95:12.5 },
          65: { P5:5.7, P10:6.2, P25:7.3, P50:8.7, P75:10.2, P90:11.8, P95:12.9 },
          70: { P5:6.1, P10:6.6, P25:7.7, P50:9.3, P75:10.9, P90:12.5, P95:13.9 },
          75: { P5:6.4, P10:7.0, P25:8.3, P50:10.0, P75:12.1, P90:14.0, P95:15.4 },
          80: { P5:6.6, P10:7.5, P25:8.9, P50:10.7, P75:13.5, P90:15.8, P95:17.2 },
          85: { P5:6.9, P10:7.9, P25:9.6, P50:11.5, P75:14.9, P90:17.7, P95:19.0 }
        },
        women: {
          60: { P5:5.8, P10:6.3, P25:7.4, P50:8.9, P75:10.5, P90:12.1, P95:13.2 },
          65: { P5:6.4, P10:7.0, P25:8.2, P50:10.0, P75:11.4, P90:13.3, P95:14.6 },
          70: { P5:7.0, P10:7.7, P25:8.9, P50:10.5, P75:12.4, P90:14.6, P95:16.1 },
          75: { P5:7.4, P10:8.2, P25:9.5, P50:11.2, P75:13.1, P90:15.8, P95:17.4 },
          80: { P5:7.6, P10:8.5, P25:10.0, P50:11.7, P75:13.7, P90:16.8, P95:18.5 },
          85: { P5:7.9, P10:9.0, P25:10.5, P50:12.3, P75:14.3, P90:17.8, P95:19.7 }
        }
      };

      const nearest = [60, 65, 70, 75, 80, 85].reduce((prev, curr) =>
        Math.abs(curr - age) < Math.abs(prev - age) ? curr : prev
      );

      let faster = "-";
      const P = norway[sex][nearest];
      if (!isNaN(total)) {
        const percentiles = [5,10,25,50,75,90,95];
        const values = percentiles.map(p => P["P"+p]);
        if (sitzZeit <= values[0]) faster = 95;
        else if (sitzZeit >= values[6]) faster = 5;
        else {
          for (let i = 0; i < values.length - 1; i++) {
            if (sitzZeit >= values[i] && sitzZeit <= values[i+1]) {
              const p0 = percentiles[i], p1 = percentiles[i+1];
              const v0 = values[i], v1 = values[i+1];
              const frac = (sitzZeit - v0) / (v1 - v0);
              faster = Math.round(100 - (p0 + frac * (p1 - p0)));
              break;
            }
          }
        }
      }

      norms.innerHTML += `<h3>Norwegische Referenzwerte zuhause lebende Personen (${nearest} Jahre â€“ ${sex === 'men' ? 'MÃ¤nner' : 'Frauen'})</h3>`;
      norms.innerHTML += `<table><tr><th>Perzentil</th><th>Wert (s)</th></tr>
        ${Object.entries(P).map(([k,v]) => `<tr><td>${k}</td><td>${v}</td></tr>`).join("")}
      </table><p>â†’ Dieser Score is besser als bei: <strong>${faster}%</strong> der Vergleichsgruppe.</p>`;

      norms.innerHTML =  <p> <strong> Einteilung ud Cut-off Werte:</strong><br></p>
      <p> z.B. 0â€“3: niedrig, 4â€“6: mittel, 7â€“9: hoch, 10â€“12: sehr hoch </p>";
      norms.classList.remove("hidden");
      btn.innerText = "ðŸ“‰ Normwerte SPPB verbergen";
      sppbVisible = true;
    }

    function toggleNormsGait() {
      const btn = document.getElementById("toggleBtnGait");
      const norms = document.getElementById("normwerteGait");
      if (gaitVisible) {
        norms.classList.add("hidden");
        btn.innerText = "ðŸ“Š Normwerte Gehgeschwindigkeit anzeigen";
        gaitVisible = false;
        return;
      }

      norms.innerHTML = "<p><strong>Normwerte Gehgeschwindigkeit:</strong><br><em>Platzhalter fÃ¼r Referenzwerte â€“ z.â€¯B. &gt;0.8â€¯m/s = gutes MobilitÃ¤tsniveau</em></p>";
      norms.classList.remove("hidden");
      btn.innerText = "ðŸ“‰ Normwerte Gehgeschwindigkeit verbergen";
      gaitVisible = true;
    }
  </script>
</body>
</html>
