
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SPPB ‚Äì Short Physical Performance Battery</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 10px;
      font-size: 16px;
      max-width: 600px;
    }
    label { display: block; margin: 10px 0 5px; }
    input, select {
      width: 100%;
      padding: 6px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      margin-top: 10px;
    }
    #result, #normwerte {
      font-weight: bold;
      margin-top: 20px;
    }
    .hidden { display: none; }
    .inline { display: inline-block; margin-right: 10px; }
    .nav-buttons {
      margin-top: 30px;
    }
    .nav-buttons a {
      display: inline-block;
      margin-right: 10px;
      padding: 10px 15px;
      background: #eee;
      border-radius: 8px;
      text-decoration: none;
      color: #000;
    }
    .nav-buttons a:hover { background: #ddd; }
  </style>
</head>
<body>
  <h1>SPPB ‚Äì Short Physical Performance Battery</h1>
  <p>Test f√ºr physische Leistungsf√§higkeit unterer Extremit√§ten.</p>
  <p>Eintragen mit Einzelwerte im Cenplex Behandlungsplan unter "Messung".</p>

  <form id="sppbForm">
    <h3>Balance</h3>
    <label><input type="checkbox" id="standZusammen"> F√º√üe zusammen >10s</label>
    <label><input type="checkbox" id="semitandem"> Semitandem >10s</label>
    <label>Tandem-Zeit (Sekunden):</label>
    <input type="number" id="tandemZeit" step="0.01"/>

    <h3>Gehgeschwindigkeit</h3>
    <label>Gemessene Strecke:</label>
    <label class="inline"><input type="radio" name="strecke" value="3" checked> 3‚ÄØm</label>
    <label class="inline"><input type="radio" name="strecke" value="4"> 4‚ÄØm</label>
    <label>Zeit (Sekunden):</label>
    <input type="number" id="gehzeit" step="0.01"/>

    <h3>5x Sitz-Stand</h3>
    <label>Zeit (Sekunden):</label>
    <input type="number" id="sitzStand" step="0.01"/>

    <button type="button" onclick="calculateSPPB()">‚úÖ Score berechnen</button>
    <button type="button" onclick="downloadPDF()">üìÑ Als PDF speichern</button>
  </form>

  <p id="result"></p>

  <div id="ageSection" class="hidden">
    <label>Alter der Person:</label>
    <input type="number" id="age" min="0" max="120"/>
    <button type="button" onclick="toggleNorms()">üìä Normwerte anzeigen</button>
    <div id="normwerte"></div>
  </div>

  <div class="nav-buttons">
    <a href="standard.html">‚¨ÖÔ∏è Zur√ºck zu Standard-Assessments</a>
    <a href="index.html">üè† Zur Startseite</a>
  </div>

  <script>
    function calculateSPPB() {
      let balance = 0;
      const tandem = parseFloat(document.getElementById("tandemZeit").value);

      if (document.getElementById("standZusammen").checked) balance += 1;
      if (document.getElementById("semitandem").checked) balance += 1;
      if (!isNaN(tandem)) {
        if (tandem >= 3 && tandem < 10) balance += 1;
        if (tandem >= 10) balance += 2;
      }

      const dist = parseFloat(document.querySelector('input[name="strecke"]:checked').value);
      const gehzeit = parseFloat(document.getElementById("gehzeit").value);
      let speed = 0;
      let gangScore = 0;

      if (!isNaN(dist) && !isNaN(gehzeit) && gehzeit > 0) {
        speed = dist / gehzeit;
        if (speed <= 0.45) gangScore = 1;
        else if (speed <= 0.64) gangScore = 2;
        else if (speed <= 0.82) gangScore = 3;
        else gangScore = 4;
      }

      const sitzZeit = parseFloat(document.getElementById("sitzStand").value);
      let sitzScore = 0;

      if (isNaN(sitzZeit) || sitzZeit > 60) sitzScore = 0;
      else if (sitzZeit > 16.7) sitzScore = 1;
      else if (sitzZeit >= 13.7) sitzScore = 2;
      else if (sitzZeit >= 11.2) sitzScore = 3;
      else sitzScore = 4;

      const total = balance + gangScore + sitzScore;
      const speedText = (!isNaN(speed)) ? speed.toFixed(2) + " m/s" : "-";

      document.getElementById("result").innerText =
        `Gesamt-Score: ${total}/12\nBalance: ${balance}/4, Gang: ${gangScore}/4, 5x Sitz-Stand: ${sitzScore}/4\nGehgeschwindigkeit: ${speedText}, 5x Sitz-Stand Zeit: ${sitzZeit}s`;

      document.getElementById("ageSection").classList.remove("hidden");
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const standZusammen = document.getElementById("standZusammen").checked;
      const semitandem = document.getElementById("semitandem").checked;
      const tandem = parseFloat(document.getElementById("tandemZeit").value);
      const dist = parseFloat(document.querySelector('input[name="strecke"]:checked').value);
      const gehzeit = parseFloat(document.getElementById("gehzeit").value);
      const sitzZeit = parseFloat(document.getElementById("sitzStand").value);
      const resultText = document.getElementById("result").innerText || "Noch kein Ergebnis berechnet.";

      let balance = 0;
      if (standZusammen) balance += 1;
      if (semitandem) balance += 1;
      if (!isNaN(tandem)) {
        if (tandem >= 3 && tandem < 10) balance += 1;
        if (tandem >= 10) balance += 2;
      }

      let speed = 0;
      let gangScore = 0;
      if (!isNaN(dist) && !isNaN(gehzeit) && gehzeit > 0) {
        speed = dist / gehzeit;
        if (speed <= 0.45) gangScore = 1;
        else if (speed <= 0.64) gangScore = 2;
        else if (speed <= 0.82) gangScore = 3;
        else gangScore = 4;
      }

      let sitzScore = 0;
      if (isNaN(sitzZeit) || sitzZeit > 60) sitzScore = 0;
      else if (sitzZeit > 16.7) sitzScore = 1;
      else if (sitzZeit >= 13.7) sitzScore = 2;
      else if (sitzZeit >= 11.2) sitzScore = 3;
      else sitzScore = 4;

      const total = balance + gangScore + sitzScore;
      const speedText = (!isNaN(speed)) ? speed.toFixed(2) + " m/s" : "-";

      let y = 10;
      doc.text("SPPB-Auswertung", 10, y); y += 10;
      doc.text(`Balance-Score: ${balance}/4`, 10, y); y += 7;
      doc.text(`Gang-Score: ${gangScore}/4`, 10, y); y += 7;
      doc.text(`Sitz-Stand-Score: ${sitzScore}/4`, 10, y); y += 7;
      doc.text(`Gesamt-Score: ${total}/12`, 10, y); y += 7;
      doc.text(`Gehgeschwindigkeit: ${speedText}`, 10, y); y += 7;
      doc.text(`5x Sitz-Stand Zeit: ${sitzZeit || "-"} s`, 10, y); y += 7;

      y += 5;
      doc.text(resultText, 10, y);

      doc.save("sppb-ergebnis.pdf");
    }
  </script>
</body>
</html>

